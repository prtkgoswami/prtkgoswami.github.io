<html>
<head>
	<title>Puffles & Dragon</title>
	<script>
		window.onload=function(){
			console.log("PAGE LOADED");
			var r=3;
			var order=10;
			var c=90;
			var s_r= document.getElementsByClassName('row')[2];
			var eat_f=0;
			var a1=0,a2=0,count=0;
			var life=0;
			var field=[[0,0,0,0,0,0,0,0,0,0],
				   [0,0,0,0,0,0,0,0,0,0],
				   [0,0,0,0,0,0,0,0,0,0],
				   [0,0,0,0,0,0,0,0,0,0],
				   [0,0,0,0,0,0,0,0,0,0],
				   [0,0,0,0,0,0,0,0,0,0],
				   [0,0,0,0,0,0,0,0,0,0],
				   [0,0,0,0,0,0,0,0,0,0],
				   [0,0,0,0,0,0,0,0,0,0],
				   [0,0,0,0,0,0,0,0,0,0]];
			
			// MAKING THE TRANSLATION MATRIX => CELL NO TO MATRIX COORDINATES
			var x=0;
			var trans=[];
			for(i=0;i<100;i++){
				for(y=0;y<10;y++){
					trans.push([x,y]);
					
				}
				x++;
			}

			// 0 = FREE (WHITE)
			// 1 = PLAYER (BLUE / PURPLE)			
			// 2 = STONES (GREY)
			// 4 = TARGET 1 (YELLOW)
			// 5 = TARGET 2 (YELLOW)
			// 6 = PREDATOR (RED)

			// IMAGE SOURCE
			// PLAYER = http://piq.codeus.net/static/media/userpics/piq_2222_400x400.png
			// STONE = http://piq.codeus.net/static/media/userpics/piq_33752_400x400.png
			// PET = http://cdn.animals-pics.com/pictures/img3.wikia.nocookie.net/__cb20131114154806/clubpenguin/images/f/fd/Gold_Puffle_in_game_walk.png
			// DRAGON = http://vignette3.wikia.nocookie.net/pixelpeople/images/c/c7/Dragon.png/revision/latest?cb=20130407015636
			// ROAD = http://piq.codeus.net/static/media/userpics/piq_44277_400x400.png
			// SKULL = http://piq.codeus.net/static/media/userpics/piq_84480_400x400.png

			
			// WAIT FUNCTION
			function waitSeconds(iMilliSeconds) {
  		  		var counter= 0, start = new Date().getTime(), end = 0;
    				while (counter < iMilliSeconds) {
        				end = new Date().getTime();
        				counter = end - start;
    				}
			}


			// INITIALIZING BOARD
			console.log("INITIALIZING THE BOARD");
			waitSeconds(500);
			for(i=0;i<100;i++){
				document.getElementsByClassName('cell')[i].style.backgroundImage="url(models/road.png)";
				document.getElementsByClassName('cell')[i].style.backgroundSize="100%";
			}

			// ASSIGNMENT OF STONES
			console.log("INITIALIZING STONES");
			waitSeconds(200);
			var st_a=[3,15,21,24,25,26,30,31,35,38,39,40,41,42,43,47,48,50,51,52,60,66,67,68,83,85,88,89,93,94,95];
			for(i=0;i<st_a.length;i++){
				document.getElementsByClassName('cell')[st_a[i]].style.backgroundImage="url(models/stone.png)";
				document.getElementsByClassName('cell')[st_a[i]].style.backgroundSize="100%";
				field[trans[st_a[i]][0]][trans[st_a[i]][1]]=2;
			}


			// INITIALIZING PLAYER POSITION
			console.log("INITIALIZING PLAYER POISITION");
			waitSeconds(200);
			var p_copy;
			document.getElementsByClassName('cell')[90].style.backgroundImage="url(models/man.png)";
			document.getElementsByClassName('cell')[90].style.backgroundSize="100%";
			field[9][0]=1;


			// INITIALIZING TARGET LOCATIONS
			console.log("INITIALIZING TARGET POISITIONS");
			waitSeconds(200);
			var c1=0,f1=0,t1_copy;
			var c2=0,f2=0,t2_copy;
			var t1=[0,10,20,10,11,12,22,32,33,34,44,54,53,63,64,74,84];
			var t2=[99,98,97,87,77,78,79,69,59,49,59,58,57,56,46,36,37,27,28,18,17,7,6,5,4];
			document.getElementsByClassName('cell')[t1[0]].style.backgroundImage="url(models/gold.png)";
			document.getElementsByClassName('cell')[t1[0]].style.backgroundSize="100%";
			document.getElementsByClassName('cell')[t2[0]].style.backgroundImage="url(models/gold.png)";
			document.getElementsByClassName('cell')[t2[0]].style.backgroundSize="100%";
			field[trans[t1[0]][0]][trans[t1[0]][1]]=4;
			field[trans[t2[0]][0]][trans[t2[0]][1]]=5;


			// INITIALIZING PREDATOR LOCATION
			console.log("INITIALIZING PREDATOR POISITION");
			waitSeconds(200); 
			var p=0,fp=0,pred_copy;
			var pred=[9,8,7,6,5,4,14,13,23,33,34,44,45,55,56,57,58,59,69,79,78,77,76,75,65,55,54,53,63,62,61];
			document.getElementsByClassName('cell')[pred[0]].style.backgroundImage="url(models/dragon.png)";
			document.getElementsByClassName('cell')[pred[0]].style.backgroundSize="100%";
			field[trans[pred[0]][0]][trans[pred[0]][1]]=6;

			
			// PRINT FIELD MATRIX
			//for(i=0;i<10;i++){
			//	for(j=0;j<10;j++)
			//		document.getElementById('win').innerHTML+=field[i][j]+" ";
			//	document.getElementById('win').innerHTML+="\n";
			//}
			

			// CHECKS THE POSITION FOR STONE
			function checkB(index){
				if(field[trans[index][0]][trans[index][1]]==2)
					return 1;
				else
					return 0;
			}

			
			// TARGET EAT
			function eat(index){
				var x,y;
				if(t1[c1]==c || t2[c2]==c){
					eat_f=1;
					count++;
				}
				else if((t1_copy+1==p_copy && t1[c1]-1==c) || (t1_copy-1==p_copy && t1[c1]+1==c) || (t1_copy+10==p_copy && t1[c1]-10==c) || (t1_copy-10==p_copy && t1[c1]+10==c)){
					eat_f=1;
					count++;
					a1=1;
					console.log("TARGET 1 EATEN");
					document.getElementById('win').innerHTML="PET 1 SAVED";
					document.getElementsByClassName('cell')[t1[c1]].style.background="white";
					field[trans[t1[c1]][0]][trans[t1[c1]][1]]=0;
					t1[c1]=100;
				}
				else if( (t2_copy+1==p_copy && t2[c2]-1==c) || (t2_copy-1==p_copy && t2[c2]+1==c) || (t2_copy+10==p_copy && t2[c2]-10==c) || (t2_copy-10==p_copy && t2[c2]+10==c)){
					eat_f=1;
					count++;
					a2=1;
					console.log("TARGET 2 EATEN");
					document.getElementById('win').innerHTML="PET 2 SAVED";
					document.getElementsByClassName('cell')[t2[c2]].style.background="white";
					field[trans[t2[c2]][0]][trans[t2[c2]][1]]=0;
					t2[c2]=100;
				}
				//console.log(eat_f);
			}


			// PLAYER EATEN
			function dead(index){
				var x,y;
				if(pred[p]==c){
					life=1;
				}	
				if((pred_copy+1==p_copy && pred[p]-1==c) || (pred_copy-1==p_copy && pred[p]+1==c) || (pred_copy+10==p_copy && pred[p]-10==c) || (pred_copy-10==p_copy && pred[p]+10==c))
					life=1;
			}


			// CHECK FOR WIN
			function victory(){
				if(count==2){
					document.getElementById('win').innerHTML="ALL PETS SAVED.. YOU WIN!!!";
					console.log("YOU WIN");
					return 1;
				}
			}

			
			// START GAME
			document.getElementById('start_btn').onclick=function(){
				console.log("START GAME");
				document.getElementById('win').innerHTML="LET THE GAME COMMENCE!";
				document.getElementById('start').style.display="none";
			}

			// MOVEMENT FUNCTION
			document.getElementById('board').onkeydown=function(event){
				var y=event.which || event.keyCode;
				if(y==65 || y==87 || y==83 || y==68){
					// TARGET MOVEMENT
					// TARGET 1
					if(a1==0){
						if(f1==0)
							c1++;
						else
							c1--;
					}
					// TARGET 2
					if(a2==0){
						if(f2==0)
							c2++;
						else
							c2--;
					}
					// CHANGING DIRECTIONS 
					if(c1%t1.length==0){
						if(c1==t1.length && c1!=0){
							f1=1;
							c1-=2;
						}
						else{
							f1=0;
						}
					}
					if(c2%t2.length==0){
						if(c2==t2.length && c2!=0){
							f2=1;
							c2-=2;
						}
						else{
							f2=0;
						}
					}
					//console.log(c1+" "+f1+" "+c2+" "+f2);

				
					// PREDATOR MOVEMENT
					if(fp==0)
						p++;
					else
						p--;
					// CHANGING DIRECTIONS 
					if(p%pred.length==0){
						if(p==pred.length && p!=0){
							fp=1;
							p-=2;
						}
						else{
							fp=0;
						}
					}
					//console.log(c1+" "+f1+" "+c2+" "+f2);
					
								

					// PLAYER MOVEMENT
					if(y==65){ // LEFT
						//if(c-1==-1||c-1==9||c-1==19||c-1==29||c-1==39||c-1==49||c-1==59||c-1==69||c-1==79||c-1==89){
							//if(checkB(c+9)==0)
								//c+=9;
						//}
						//else{
							if(c%10!=0 && checkB(c-1)==0)
								c-=1;
						//}
					}
					else if(y==87){ // TOP
						//if(c-10<0 && checkB(c+90)==0)
							//c+=90;
						//else 
						if(c-10>=0 && checkB(c-10)==0)
							c-=10;
					}
					else if(y==83){ // BOTTOM
						//if(c+10>99 && checkB(c-90)==0)
							//c-=90;
						//else 
						if(c+10<=99 && checkB(c+10)==0)
							c+=10;
					}	
					else if(y==68){ // RIGHT
						//if(((c+1)%10==0) && checkB(c-9)==0)
							//c-=9;
						//else 
						if(((c+1)%10!=0) && checkB(c+1)==0)
							c+=1;
					}
					for(i=0;i<100;i++){
						if(checkB(i)==0){
							document.getElementsByClassName('cell')[i].style.backgroundImage="url(models/road.png)";
							document.getElementsByClassName('cell')[i].style.backgroundSize="100%";
							field[trans[i][0]][trans[i][1]]=0;
						}
					}	
				
				

					if(a1==0){
						document.getElementsByClassName('cell')[t1[c1]].style.backgroundImage="url(models/gold.png)";
						document.getElementsByClassName('cell')[t1[c1]].style.backgroundSize="100%";
						field[trans[t1[c1]][0]][trans[t1[c1]][1]]=4;
					}
					if(a2==0){
						document.getElementsByClassName('cell')[t2[c2]].style.backgroundImage="url(models/gold.png)";
						document.getElementsByClassName('cell')[t2[c2]].style.backgroundSize="100%";
						field[trans[t2[c2]][0]][trans[t2[c2]][1]]=5;
					}
				
					
					document.getElementsByClassName('cell')[pred[p]].style.backgroundImage="url(models/dragon.png)";
					document.getElementsByClassName('cell')[pred[p]].style.backgroundSize="100%";
					field[trans[pred[p]][0]][trans[pred[p]][1]]=6;
					
					console.log(c+" "+pred[p]+" "+t1[c1]+" "+t2[c2]+" "+p_copy+" "+pred_copy+" "+t1_copy+" "+t2_copy+"  "+count);
					// CHECK FOR TARGET
					eat(c);
					if(field[trans[c][0]][trans[c][1]]==4 && eat_f==1){
						console.log("TARGET 1 EATEN");
						document.getElementById('win').innerHTML="PET 1 FOUND";
						a1=1;
					}
					else if(field[trans[c][0]][trans[c][1]]==5 && eat_f==1){
						console.log("TARGET 2 EATEN");
						document.getElementById('win').innerHTML="PET 2 SAVED";
						a2=1;
					}
				
					// CHECK FOR PREDATOR
					dead(c);
					if(life==1){
						document.getElementsByClassName('cell')[c].style.backgroundImage="url(models/skull.png)";
						document.getElementsByClassName('cell')[c].style.backgroundSize="100%";
						document.getElementById('win').innerHTML="PLAYER EATEN...GAME OVER";
						console.log("PLAYER EATEN...GAME OVER");
						document.getElementById('end').style.display = 'block';
					}


					if(eat_f==0 && life==0){
						document.getElementsByClassName('cell')[c].style.backgroundImage="url(models/man.png)";
						document.getElementsByClassName('cell')[c].style.backgroundSize="100%";
						field[trans[c][0]][trans[c][1]]=1;
					}
					else if(life==0){
						//document.getElementsByClassName('cell')[c].style.backgroundColor="purple";
						document.getElementsByClassName('cell')[c].style.backgroundImage="url(models/man.png)";
						document.getElementsByClassName('cell')[c].style.backgroundSize="100%";
						field[trans[c][0]][trans[c][1]]=1;
					}
					eat_f=0;

					
					// DARKEN
					for(i=0;i<100;i++){
						console.log(i+" "+c);
						if(c==0)
							if(i!=c && i!=c+1 && i!=c+11 && i!=c+10)
								document.getElementsByClassName('cell')[i].style.background="black";
						else if(c==9)
							if(i!=c && i!=c-1 && i!=c+9 && i!=c+10)
								document.getElementsByClassName('cell')[i].style.background="black";
						else if(c==90)
							if(i!=c && i!=c+1 && i!=c-9 && i!=c-10)
								document.getElementsByClassName('cell')[i].style.background="black";
						else if(c==99)
							if(i!=c && i!=c-1 && i!=c-11 && i!=c-10)
								document.getElementsByClassName('cell')[i].style.background="black";
						else if(c%10==0)
							if(i!=c && i!=c+1 && i!=c+10 && i!=c-10 && i!=c-9 && i!=c+11)
								document.getElementsByClassName('cell')[i].style.background="black";
						else if(c-10<0)
							if(i!=c && i!=c+1 && i!=c+10 && i!=c-1 && i!=c+9 && i!=c+11)
								document.getElementsByClassName('cell')[i].style.background="black";
						else if((c+1)%10==0)
							if(i!=c && i!=c-1 && i!=c-10 && i!=c+10 && i!=c+9 && i!=c-11)
								document.getElementsByClassName('cell')[i].style.background="black";
						else if(c+10>99){
							if(i!=c && i!=c+1 && i!=c-10 && i!=c-1 && i!=c-9 && i!=c-11)
								document.getElementsByClassName('cell')[i].style.background="black";
						}
						else
							if(i!=c && i!=c-1 && i!=c+1 && i!=c-10 && i!=c+10 && i!=c+9 && i!=c-11 && i!=c+11 && i!=c-9)
								document.getElementsByClassName('cell')[i].style.background="black";
					}

					
					if(victory()==1)
						document.getElementById('end').style.display = 'block';
				
					p_copy=c;// PREVIOUS PLAYER POS
					pred_copy=pred[p];// PREVIOUS PREDATOR POSITION
					t1_copy=t1[c1];// PREVIOUS TARGET 1 POSITION
					t2_copy=t2[c2];// PREVIOUS TARGET 2 POSITION
					
				}
				
			};
		};
	</script>
	<style>
		body{
			background-color:#1f1f1f;
		}
		#board{
			width:520px;
			height:520px;
			margin-top:40px;
			z-index:1;
		}
		.cell{
			height:50px;
			width:50px;
			border:1px solid black;
			float:left;
			background-image:url(models/road.png);
			background-size:100%;
		}
		#board .row{
			width:520px;
		}
		.stone{
			background-color:grey;
		}
		#win{
			border:1px solid white;
			color:white;
			width:250px;
			height:20px;
		}
		.block{
			width:520px;
			height:520px;
			position:absolute;
			display:block;
		}
		#start{
			margin:0 auto 0 30.3%;
			display:block;
			background:rgba(0,0,0,0.8);
			
		}
		#start h2,#start p{color:white;}
		#end{
			margin:-520px auto 0 30.3%;
			display:none;	
			background:rgba(0,0,0,0.9);
		}
		#end h1,#end p{color:white;}
	</style>
	
</head>
<body>
	<center>
		<div id="start" class="block">
			<center>
				<br/><br/><br/><br/><br/><br/><br/><br/><br/>
				<h2>PUFFLES & DRAGON</h2>
				<p>Your Pet Puffles are hidden and roaming insite the dragon's cave.</p>
				<p> Save them Before the Dragon Finds You!</p>
				<button id="start_btn">START GAME!</button>
			</center>
		</div>
		<div id="board" tabindex="1">
			<div class="row">
				<div class="cell a"></div>
				<div class="cell a"></div>
				<div class="cell a"></div>
				<div class="cell a"></div>
				<div class="cell a"></div>
				<div class="cell a"></div>
				<div class="cell a"></div>
				<div class="cell a"></div>
				<div class="cell a"></div>
				<div class="cell a"></div>
			</div>
			<div class="row">
				<div class="cell b"></div>
				<div class="cell b"></div>
				<div class="cell b"></div>
				<div class="cell b"></div>
				<div class="cell b"></div>
				<div class="cell b"></div>
				<div class="cell b"></div>
				<div class="cell b"></div>
				<div class="cell b"></div>
				<div class="cell b"></div>
			</div>
			<div class="row">
			<div class="cell c"></div>
				<div class="cell c"></div>
				<div class="cell c"></div>
				<div class="cell c"></div>
				<div class="cell c"></div>
				<div class="cell c"></div>
				<div class="cell c"></div>
				<div class="cell c"></div>
				<div class="cell c"></div>
				<div class="cell c"></div>
			</div>
			<div class="row">
				<div class="cell d"></div>
				<div class="cell d"></div>
				<div class="cell d"></div>
				<div class="cell d"></div>
				<div class="cell d"></div>
				<div class="cell d"></div>
				<div class="cell d"></div>
				<div class="cell d"></div>
				<div class="cell d"></div>
				<div class="cell d"></div>
			</div>
			<div class="row">
				<div class="cell e"></div>
				<div class="cell e"></div>
				<div class="cell e"></div>
				<div class="cell e"></div>
				<div class="cell e"></div>
				<div class="cell e"></div>
				<div class="cell e"></div>
				<div class="cell e"></div>
				<div class="cell e"></div>
				<div class="cell e"></div>
			</div>
			<div class="row">
				<div class="cell f"></div>
				<div class="cell f"></div>
				<div class="cell f"></div>
				<div class="cell f"></div>
				<div class="cell f"></div>
				<div class="cell f"></div>
				<div class="cell f"></div>
				<div class="cell f"></div>
				<div class="cell f"></div>
				<div class="cell f"></div>
			</div>
			<div class="row">
				<div class="cell g"></div>
				<div class="cell g"></div>
				<div class="cell g"></div>
				<div class="cell g"></div>
				<div class="cell g"></div>
				<div class="cell g"></div>
				<div class="cell g"></div>
				<div class="cell g"></div>
				<div class="cell g"></div>
				<div class="cell g"></div>
			</div>
			<div class="row">
				<div class="cell h"></div>
				<div class="cell h"></div>
				<div class="cell h"></div>
				<div class="cell h"></div>
				<div class="cell h"></div>
				<div class="cell h"></div>
				<div class="cell h"></div>
				<div class="cell h"></div>
				<div class="cell h"></div>
				<div class="cell h"></div>
			</div>
			<div class="row">
				<div class="cell i"></div>
				<div class="cell i"></div>
				<div class="cell i"></div>
				<div class="cell i"></div>
				<div class="cell i"></div>
				<div class="cell i"></div>
				<div class="cell i"></div>
				<div class="cell i"></div>
				<div class="cell i"></div>
				<div class="cell i"></div>
			</div>
			<div class="row">
				<div class="cell j"></div>
				<div class="cell j"></div>
				<div class="cell j"></div>
				<div class="cell j"></div>
				<div class="cell j"></div>
				<div class="cell j"></div>
				<div class="cell j"></div>
				<div class="cell j"></div>
				<div class="cell j"></div>
				<div class="cell j"></div>
			</div>
		</div>
		<div id="end" class="block">
			<center>
				<br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/>
				<h1>GAME OVER</h1>
				<p>Please Reload Page To Start Again</p>
			</center>
		</div>
		<p id="win"></p>
	</center>
</body>
</html>